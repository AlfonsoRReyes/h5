```{r init, include=FALSE}
if(file.exists("test.h5")) file.remove("test.h5")
```
We start by creating an HDF5 file holding a numeric vector, an integer matrix and a character array.

```{r h5q-1, echo=TRUE, eval=TRUE}
library(h5)
testvec <- rnorm(10)
testmat <- matrix(1:9, nrow = 3)
row.names(testmat) <- 1:3
colnames(testmat) <- c("A", "BE", "BU")
letters1 <- paste(LETTERS[runif(45, min = 1, max = length(LETTERS))])
letters2 <- paste(LETTERS[runif(45, min = 1, max = length(LETTERS))])
testarray <- array(paste0(letters1, letters2), c(3, 3, 5))

file <- h5file("test.h5")
# Save testvec in group 'test' as DataSet 'testvec'
file["test/testvec"] <- testvec
file["test/testmat"] <- testmat
file["test/testarray"] <- testarray
h5close(file)
```

We can now retrieve the data from the file

```{r h5q-2, echo=TRUE, eval=TRUE}
file <- H5File("test.h5")
dataset_testmat <- file["test/testmat"]
# We can now retrieve all data from the DataSet object using e.g. the  subsetting operator
dataset_testmat[]
```

We can also subset the data directly, e.g. row 1 and 3
```{r h5q-3, echo=TRUE, eval=TRUE}
dataset_testmat[c(1, 3), ]
```

Note, that we have now lost the row- and column names associated with the *testmat* object
in the retrieved matrix. HDF5 supports metadata with attributes, which we need to
add to (retrieve from) the DataSet manually.

```{r h5q-4, echo=TRUE, eval=TRUE}
h5attr(dataset_testmat, "rownames") <- row.names(testmat)
h5attr(dataset_testmat, "colnames") <- colnames(testmat)
```

We can now retrieve our matrix including meta-data as follows:


```{r h5q-5, echo=TRUE, eval=TRUE}
outmat <- dataset_testmat[]
row.names(outmat) <- h5attr(dataset_testmat, "rownames")
colnames(outmat) <- h5attr(dataset_testmat, "colnames")
identical(outmat, testmat)
```

Do not forget to close the HDF5 file in the end

```{r h5q-6, echo=TRUE, eval=TRUE}
h5close(file)
```
```{r cleanup, include=FALSE}
if(file.exists("test.h5")) file.remove("test.h5")
```